'use strict'

// Dependencies
const Mocha = require('mocha')
const fs = require('fs')
const path = require('path')

// Define Mocha
const mocha = new Mocha({
  timeout: 600000,
  reporter: 'spec',
  useColors: true,
  ignoreLeaks: true
})

const testDir = path.join(process.cwd(), 'middleware/test')

// Add each .js file to the mocha instance
fs.readdirSync(testDir)
  .filter(file => {
    // Only keep the .js files
    return file.substr(-7) === 'spec.js'
  })
  .forEach(file => {
    mocha.addFile(path.join(testDir, file))
  })

// Run unit tests
mocha.run(function (failures) {
  process.exit(failures)
})
